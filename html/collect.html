<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
	<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
	<title>光谱采集</title>
	<link rel="stylesheet" type="text/css" href="../css/api.css" />
	<link rel="stylesheet" type="text/css" href="../css/style.css" />
	<link rel="stylesheet" type="text/css" href="../css/index.css" />
</head>

<body>
	<div class="cj_title">
		<img src="../img/jg_banner.png" />
		<div class="data">
			<div class="d_con">
				<div class="d_left">
					<span class="num01" id="dnMin">0</span>
					<p>MIN</p>
				</div>
				<div class="d_middle">
					<span class="num02" id="dnAve">0</span>
					<p>平均值</p>
				</div>
				<div class="d_left">
					<span class="num01" id="dnMax">0</span>
					<p>MAX</p>
				</div>
			</div>
		</div>
		<p class="d_txt">正在检测DN值</p>
	</div>
	<div id="chart" class="chart" style="height:200px;">
	</div>
	<div class="c_btn">
		<img src="../img/icon_collection_default.png" />
	</div>
</body>

</html>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/dp.js"></script>
<script type="text/javascript" src="../script/ble.js"></script>
<script type="text/javascript" src="../script/echarts.js"></script>
<script type="text/javascript">
	var myChart = echarts.init(document.getElementById('chart'));
	var finallyData = [];

	apiready = function() {
		$api.attr($api.dom('.chart'), 'width', api.winWidth);
		bleInit(function(){
			//connectDevice("DC:0D:30:00:0C:56");
		});


		DPTool.loadData(initChat, function(datas){
				finallyData = datas;
		});
	}

	$api.addEvt($api.dom('.c_btn img'), 'click', function() {
		//connectDevice("DC:0D:30:00:0C:56");
		sendData();
		//gotoResult();
	});

	function initChat(datas) {
		var i;
		var min = 1000000,max = 0, average, sum = 0;
		for (i = 0; i < datas.length; i++){
				var data = datas[i];
				if (data > max) max = data;
				if (data < min) min = data;
				sum += data;
		}
		average =  Math.round(sum / datas.length);
		$api.text($api.dom('#dnMin'), min);
		$api.text($api.dom('#dnMax'), max);
		$api.text($api.dom('#dnAve'), average);
		finallyData = datas;

		// 指定图表的配置项和数据
		var option = {
			grid: {
				left: 40,
				top: 40,
				right: 0,
				bottom: 40,
				borderWidth: 1
			},
			title: {

				text: 'DN值',
				textStyle: {
					color: '#00DEFF',
					align: 'left',
				},
				padding: 5,
				itemGap: 0
			},
			tooltip: {
				trigger: 'axis',
				formatter: "波长：{b}nm <br/> {a} : {c}"
			},
			xAxis: {
				data: DPTool.getXAxis(),
				name: '波长(nm)',
				nameLocation: 'middle',
				nameGap: '30',
				nameTextStyle: {
					color: '#00DEFF'
				},
				axisTick: {
					lineStyle: {
						color: '#E1E1E1'
					}
				},
				axisLine: {
					show: false
				},
				axisLabel: {
					color: '#666666'
				}
			},
			yAxis: {
				formatter: '{value}',
				axisLine: {
					show: false
				},
				axisTick: false,
				axisLabel: {
					color: '#666666'
				}
			},
			series: [{
				name: 'DN值',
				type: 'line',
				lineStyle: {
					normal: {
						color: '#00DEFF',
					}
				},
				smooth: true,
				showSymbol: false,
				data: datas
			}]
		};
		// 使用刚指定的配置项和数据显示图表。
		myChart.setOption(option);
	}

	function gotoResult() {
		api.openWin({
			name: 'connect',
			url: './result.html',
			pageParam: {
				datas: finallyData
			}
		});
	}
</script>
